#+title: XMonad configuration
#+PROPERTY: header-args:haskell :tangle ~/.xmonad/xmonad.hs :mkdirp yes
 
Xmonad configuration file
* header - imports
#+begin_src haskell
  import XMonad
  import Data.Monoid
  import System.Exit
  import qualified XMonad.StackSet as W
  import qualified Data.Map        as M

  import XMonad.Util.Run
  import XMonad.Util.EZConfig
  import XMonad.Util.SpawnOnce

  import XMonad.Layout.NoBorders
  import XMonad.Layout.PerWorkspace
  import XMonad.Layout.TwoPane

  import XMonad.Hooks.DynamicLog
  import XMonad.Hooks.EwmhDesktops
  import XMonad.Hooks.ManageDocks

  import XMonad.Prompt
  import XMonad.Prompt.ConfirmPrompt
  import XMonad.Prompt.Shell
  import XMonad.Prompt.Window

  import Graphics.X11.ExtraTypes.XF86
#+end_src
* constants
#+begin_src haskell
  myTerminal          = "alacritty" -- The preferred terminal program.
  myScreenShootProgram = "scrot"
  myFocusFollowsMouse = False     -- Whether focus follows the mouse pointer.
  myClickJustFocuses  = False     -- Whether clicking on a window to focus also passes the click to the window
  myBorderWidth       = 2         -- Width of the window border in pixels.
  myModMask           = mod4Mask  -- modMask lets you specify which modkey you want to use.
  myFloatSize           = W.RationalRect (1/4) (1/4) (1/2) (1/2)

  -- The default number of workspaces (virtual screens) and their names.
  -- A tagging example:
  -- > workspaces = ["web", "irc", "code" ] ++ map show [4..9]
  myWorkspaces     = ["1",  "2",  "3",  "4",  "5",  "6",  "7",  "8"]
  myWorkspacesKeys = [xK_q, xK_w, xK_e, xK_r, xK_t, xK_y, xK_u, xK_i]

  -- Colors definitions
  colCyan1 = "#008080"
  colCyan2 = "#003030"

  -- Border colors for unfocused and focused windows, respectively.
  myNormalBorderColor  = colCyan2
  myFocusedBorderColor = colCyan1

  -- my commands
  myLockCmd = "slock"
  myScriptsPath = "/home/jotix/.scripts/"
  myVolumeDownCmd = myScriptsPath ++ "volctl -d"
  myVolumeUpCmd   = myScriptsPath ++ "volctl -u"
  myVolumeMuteCmd = myScriptsPath ++ "volctl -m"

  -- Menus Command
  myMenuFgColor = "'" ++ colCyan1 ++ "'"
  myMenuBgColor = "'" ++ colCyan2 ++ "'"
  myMenuFont  = "'Ubuntu Mono Bold 12'"
  myDMenuFont = "UbuntuMono:style=Bold:pixelsize=16:antialias=true"
  --myMenu      = "bemenu-run --fn '" ++ myMenuFont ++ "' --nb=" ++  colCyan2 ++ " --nf=" ++ colCyan1
  --               ++ " --hb=" ++ colCyan1 ++ " --hf=" ++ colCyan2 ++ " --tb=" ++ colCyan2 ++ " --tf=" 
  --               ++ colCyan1 ++ " --ff=" ++ colCyan1 ++ " --fb=" ++ colCyan2
  myRofiMenu  = "rofi -show drun -show-icons -font " ++ myMenuFont
  myRofiWindowSelectorMenu  = "rofi -show window -show-icons -font " ++ myMenuFont
#+end_src
* keybinds
#+begin_src  haskell
  myKeys conf@(XConfig {XMonad.modMask = modm}) = M.fromList $

      -- volume control -- volctl must be in PATH
      [ ((0, xF86XK_AudioLowerVolume), spawn myVolumeDownCmd) 
      , ((0, xF86XK_AudioRaiseVolume), spawn myVolumeUpCmd)
      , ((0, xF86XK_AudioMute),        spawn myVolumeMuteCmd)

      -- launch a terminal
      , ((modm, xK_Return), spawn $ XMonad.terminal conf)

      -- rofi window sel
      , ((modm, xK_o), spawn myRofiWindowSelectorMenu)

      -- Menu
      , ((modm, xK_p), spawn myRofiMenu)

      -- Runs the screenshoot program
      , ((modm .|. shiftMask, xK_s), spawn myScreenShootProgram)

      -- close focused window
      , ((modm, xK_x), kill)

      -- Rotate through the available layout algorithms
      , ((modm, xK_space), sendMessage NextLayout)

      --  Reset the layouts on the current workspace to default
      , ((modm .|. shiftMask, xK_space), setLayout $ XMonad.layoutHook conf)

      -- Resize viewed windows to the correct size
      , ((modm, xK_v), refresh)

      -- Move focus to the next window
      , ((modm, xK_k), windows W.focusDown)

      -- Move focus to the previous window
      , ((modm, xK_j), windows W.focusUp)

      -- Swap the focused window with the next window
      , ((modm .|. shiftMask, xK_j), windows W.swapDown)

      -- Swap the focused window with the previous window
      , ((modm .|. shiftMask, xK_k), windows W.swapUp)

      -- Swap the focused window and the master window
      , ((modm .|. shiftMask, xK_Return), windows W.swapMaster)

      -- Move focus & shift master (for focus floating windows stay ontop)
      , ((modm, xK_Tab), windows W.focusUp >> windows W.shiftMaster)

      -- Shrink the master area
      , ((modm, xK_h), sendMessage Shrink)

      -- Expand the master area
      , ((modm, xK_l), sendMessage Expand)

      -- Push window back into tiling
      , ((modm, xK_g), withFocused $ windows . W.sink) 

      -- Set windows as floating
      , ((modm, xK_f), withFocused $ windows . (flip W.float $ myFloatSize))

      -- Increment the number of windows in the master area
      , ((modm, xK_n), sendMessage (IncMasterN 1))

      -- Deincrement the number of windows in the master area
      , ((modm, xK_m), sendMessage (IncMasterN (-1)))

      -- Toggle bar
      -- , ((modm, xK_b), sendMessage ToggleStruts) -- is set on the main function

      -- Screen lock
      , ((modm .|. shiftMask, xK_l), spawn myLockCmd)

      -- Quit xmonad
      , ((modm .|. shiftMask, xK_x)
      , confirmPrompt myXPromptConfig "exit" $ io (exitWith ExitSuccess))

      -- Restart xmonad
      , ((modm .|. shiftMask, xK_c), spawn "xmonad --recompile && xmonad --restart")

      -- Run xmessage with a summary of the default keybindings (useful for beginners)
      , ((modm, xK_slash), spawn ("echo '" ++ help ++ "' | xmessage -file -"))
      ]
      ++
      --
      -- mod-[q..i], Switch to workspace N
      -- mod-shift-[q..i], Move client to workspace N
      --
      [((m .|. modm, k), windows $ f i)
          | (i, k) <- zip (XMonad.workspaces conf) myWorkspacesKeys
          , (f, m) <- [(W.view, 0), (W.shift, shiftMask)]]    
#+end_src
* prompt
#+begin_src haskell
  myXPromptConfig = def 
      { font              = "xft:Ubuntu Mono:style=Bold:pixelsize=16"
      , bgColor           = colCyan2
      , fgColor           = colCyan1
      , position          = Top 
      , promptBorderWidth = 1
      , borderColor       = colCyan1
      , height            = 24
      }

#+end_src
* mouse bindings
#+begin_src haskell
  myMouseBindings (XConfig {XMonad.modMask = modm}) = M.fromList $

      -- mod-button1, Set the window to floating mode and move by dragging
      [ ((modm, button1), (\w -> focus w >> mouseMoveWindow w
                                         >> windows W.shiftMaster))

      -- mod-button2, Raise the window to the top of the stack
      , ((modm, button2), (\w -> focus w >> windows W.shiftMaster))

      -- mod-button3, Set the window to floating mode and resize by dragging
      , ((modm, button3), (\w -> focus w >> mouseResizeWindow w
                                         >> windows W.shiftMaster))

      -- you may also bind events to the mouse scroll wheel (button4 and button5)
      ]
#+end_src
* layouts
#+begin_src haskell
  -- You can specify and transform your layouts by modifying these values.
  -- If you change layout bindings be sure to use 'mod-shift-space' after
  -- restarting (with 'mod-q') to reset your layout state to the new
  -- defaults, as xmonad preserves your old layout settings by default.
  --
  -- The available layouts.  Note that each layout is separated by |||,
  -- which denotes layout choice.
  --
  myLayout =  avoidStruts $ Tall 1 (3/100) (1/2) ||| noBorders Full

#+end_src
* window rules
#+begin_src haskell
  -- Execute arbitrary actions and WindowSet manipulations when managing
  -- a new window. You can use this to, for example, always float a
  -- particular program, or have a client always appear on a particular
  -- workspace.
  --
  -- To find the property name associated with a program, use
  -- > xprop | grep WM_CLASS
  -- and click on the client you're interested in.
  --
  -- To match on the WM_NAME, you can use 'title' in the same way that
  -- 'className' and 'resource' are used below.
  --
  --myManageHook = manageDocks <+> composeAll
  myManageHook = composeAll
      [ className =? "Pavucontrol"    --> doFloat
      , className =? "Galculator"     --> doFloat
      , resource  =? "Dialog"         --> doFloat
      , className =? "Xmessage"       --> doFloat
      , className =? "Xsane"          --> doFloat
      , className =? "Lutris"         --> doFloat
      , className =? "Steam"          --> doFloat
      , title     =? "Blizzard Battle.net"    --> doFloat
      , title     =? "World of Warcraft"      --> doShift "9"
      , title     =? "Wreckfest*"     --> doShift "9"
      , className =? "spotify"        --> doFloat
      , className =? "spotify"        --> doShift "8"
      ]

#+end_src
* event handling
#+begin_src haskell
  -- * EwmhDesktops users should change this to ewmhDesktopsEventHook
  --
  -- Defines a custom handler function for X Events. The function should
  -- return (All True) if the default handler is to be run afterwards. To
  -- combine event hooks use mappend or mconcat from Data.Monoid.
  --
  myEventHook = do
      fullscreenEventHook

#+end_src
* startup hook
#+begin_src haskell
  -- Perform an arbitrary action each time xmonad starts or is restarted
  -- with mod-q.  Used by, e.g., XMonad.Layout.PerWorkspace to initialize
  -- per-workspace layout choices.
  --
  -- By default, do nothing.
  myStartupHook = return ()

#+end_src
* status bar
#+begin_src haskell
  -- Perform an arbitrary action on each internal state change or X event.
  -- See the 'XMonad.Hooks.DynamicLog' extension for examples.
  myLogHook = return()

#+end_src
* main function
#+begin_src haskell
  main = xmonad =<< statusBar myBar myPP toggleStrutsKey myConfig

  -- Command to launch the bar.
  myBar = "xmobar ~/.xmonad/xmobarrc"

  -- Custom PP, configure it as you like. It determines what is being written to the bar.
  myPP = xmobarPP
      { ppCurrent         = xmobarColor "#00b0b0" "" . wrap "[" "]" 
      , ppVisible         = xmobarColor "#007070" "" . wrap "(" ")"
      , ppHidden          = xmobarColor "#008080" "" . wrap "*" "" 
      , ppHiddenNoWindows = xmobarColor "#006060" "" 
      , ppTitle           = xmobarColor "#008080" "" . shorten 60 
      , ppUrgent          = xmobarColor "red" "yellow"
      , ppWsSep           = " "
      , ppSep             = " : "
      }

  -- Key binding to toggle the gap for the bar.
  toggleStrutsKey XConfig {XMonad.modMask = modMask} = (modMask, xK_b)

  -- Main configuration, override the defaults to your liking.
  myConfig = ewmh def
          { terminal           = myTerminal
          , focusFollowsMouse  = myFocusFollowsMouse
          , clickJustFocuses   = myClickJustFocuses
          , borderWidth        = myBorderWidth
          , modMask            = myModMask
          , workspaces         = myWorkspaces
          , normalBorderColor  = myNormalBorderColor
          , focusedBorderColor = myFocusedBorderColor
          -- key bindings
          , keys               = myKeys
          , mouseBindings      = myMouseBindings
          -- hooks, layouts
          , layoutHook         = myLayout
          , manageHook         = myManageHook
          , handleEventHook    = myEventHook
          , logHook            = myLogHook
          , startupHook        = myStartupHook
          }

#+end_src
* help message
#+begin_src haskell
  ------------------------------------------------------------------------
  -- | Finally, a copy of the default bindings in simple textual tabular format.
  help :: String
  help = unlines 
      [ "The default modifier key is 'alt'. Default keybindings:"
      , ""
      , "-- launching and killing programs"
      , "mod-Shift-Enter  Launch xterminal"
      , "mod-p            Launch prompt shell"
      , "mod-Shift-p      Launch prompt windows"
      , "mod-x            Close/kill the focused window"
      , "mod-Space        Rotate through the available layout algorithms"
      , "mod-Shift-Space  Reset the layouts on the current workSpace to default"
      , "mod-v            Resize/refresh viewed windows to the correct size"
      , ""
      , "-- move focus up or down the window stack"
      , "mod-Left     Move focus to the previous window"
      , "mod-Right    Move focus to the next window"
      , "mod-Space        Rotate through the available layout algorithms"
      , "mod-Shift-Space  Reset the layouts on the current workSpace to default"
      , "mod-v            Resize/refresh viewed windows to the correct size"
      , ""
      , "-- move focus up or down the window stack"
      , "mod-Left     Move focus to the previous window"
      , "mod-Right    Move focus to the next window"
      , ""
      , "-- modifying the window order"
      , "mod-Shift-m      Swap the focused window and the master window"
      , "mod-Shift-Right  Swap the focused window with the next window"
      , "mod-Shift-Left   Swap the focused window with the previous window"
      , ""
      , "-- resizing the master/slave ratio"
      , "mod-Shift-Left   Shrink the master area"
      , "mod-Shift-Right  Expand the master area"
      , ""
      , "-- floating layer support"
      , "mod-g  Push window back into tiling; unfloat and re-tile it"
      , ""
      , "-- increase or decrease number of windows in the master area"
      , "mod-n  Increment the number of windows in the master area"
      , "mod-m  Deincrement the number of windows in the master area"
      , ""
      , "-- quit, or restart"
      , "mod-Shift-x  Quit xmonad"
      , "mod-Shift-c  Restart xmonad"
      , "mod-[q..o]   Switch to workSpace N"
      , ""
      , "-- Workspaces & screens"
      , "mod-Shift-[q..o]   Move client to workspace N"
      , ""
      , "-- Mouse bindings: default actions bound to mouse events"
      , "mod-button1  Set the window to floating mode and move by dragging"
      , "mod-button2  Raise the window to the top of the stack"
      , "mod-button3  Set the window to floating mode and resize by dragging"
      ]
#+end_src
