#+title: Jotix dotfiles

* dotfiles
** gitconfig
#+begin_src conf :tangle ~/.config/git/config :mkdirp yes
  [user]
  email = jujodeve@gmail.com
  name = jotix  
#+end_src
** gpg-agent.conf
#+begin_src conf :tangle ~/.gnupg/gpg-agent.conf :mkdirp yes
  allow-emacs-pinentry
#+end_src
** bashrc
#+begin_src shell :tangle ~/.bashrc 
  ### DON'T EDIT THIS FILE
  ### THIS FILE IS GENERATED BY EMACS
  ### EDIT the dotfiles.org file instead

  # ~/.bashrc: executed by bash(1) for non-login shells.
  # see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
  # for examples

  # If not running interactively, don't do anything
  [[ $- != *i* ]] && return

  # don't put duplicate lines or lines starting with space in the history.
  # See bash(1) for more options
  HISTCONTROL=ignoreboth

  # append to the history file, don't overwrite it
  shopt -s histappend

  # for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
  HISTSIZE=1000
  HISTFILESIZE=2000

  # check the window size after each command and, if necessary,
  # update the values of LINES and COLUMNS.
  shopt -s checkwinsize

  # make less more friendly for non-text input files, see lesspipe(1)
  [ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

  # Add an "alert" alias for long running commands.  Use like so:
  #   sleep 10; alert
  alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'

  export ALTERNATE_EDITOR=""
  export EDITOR=nvim  # $EDITOR opens in terminal
  export VISUAL="emacsclient -c -a emacs"         # $VISUAL opens in GUI mode

  ### ls alias
  alias ls='ls --color=auto'
  alias grep='grep --color=auto'
  alias fgrep='fgrep --color=auto'
  alias egrep='egrep --color=auto'
  alias ll='ls -alF'
  alias la='ls -A'

  ### alias for core utils
  alias ls=exa
  alias cat=bat

  ### nvim alias
  alias vim=nvim
  alias vi=nvim

  ### flatpak protontricks
  alias protontricks-flat='flatpak run --command=protontricks com.valvesoftware.Steam'

  ### git-prompt
  . ~/.dotfiles/git-prompt.sh
  GIT_PS1_SHOWDIRTYSTATE=1
  GIT_PS1_SHOWSTASHSTATE=1
  GIT_PS1_SHOWUNTRACKEDFILES=1
  GIT_PS1_SHOWUPSTREAM="auto"
  GIT_PS1_SHOWCOLORHINTS=1
  PROMPT_COMMAND='__git_ps1 "\u@\h:\w" "\\\$ "'

  PATH=$PATH:$HOME/.local/bin:$HOME/.dotfiles/scripts

  ### autochange dirs
  shopt -s autocd

  neofetch
#+end_src
* docs
*** pulseaudio split front/rear
Splitting front/rear

Connect speakers to front analog output and headphones to rear output. It would be useful to split front/rear to separate sinks. Add to /etc/pulse/default.pa:

load-module module-remap-sink sink_name=speakers sink_properties="device.description='Speakers'" remix=no master=alsa_output.pci-0000_0a_00.3.analog-surround-40 channels=2 master_channel_map=front-left,front-right channel_map=front-left,front-right
load-module module-remap-sink sink_name=headphones sink_properties="device.description='Headphones'" remix=no master=alsa_output.pci-0000_0a_00.3.analog-surround-40 channels=2 master_channel_map=rear-left,rear-right channel_map=front-left,front-right

Make sure to replace alsa_output.pci-0000_05_00.0.analog-surround-40 with the sound card name shown in 'pacmd list-sinks'. Now you have 2 additional sinks which can be used separately. You can choose 'sink_name' freely, as long as there is no sink with that name already. The 'remix' parameter controls whether the audio should be down-/upmixed to match the channels in the sink.
Tip: If pulseaudio fails with master sink not found, comment out the remapping lines, start PulseAudio and verify your card output is set to the one you specified (e.g. analog surround 4.0). Alternatively, try using a sink index[broken link: invalid section] instead of a sink name.

*** pulseaudio separate headphones speakers
Having both speakers and headphones plugged in and switching in software on-the-fly

By design, Pulseaudio automatically turns off Line Out when headphones are plugged in and uses Headphone slider instead. You can observe this behavior in alsamixer. What we want is to have Headphone and Line Out sliders working separately and at the same time. This is extremely useful if you want to remap Realtek's jacks to have, say, Rear Green for headphones and Blue for speakers (with the help of hdajackretask from alsa-tools).

To achieve this, you should directly edit Pulseaudio mixer's configuration.

1. We tell pulseaudio that headphones are always plugged in. Edit:

/usr/share/pulseaudio/alsa-mixer/paths/analog-output-lineout.conf

Find:

[Jack Headphone]
state.plugged = no
state.unplugged = unknown

Change no to yes

2. By default, Line Out's volume controlled only by Master, and not by Line Out slider itself. We want to merge Line Out with Master.

Add this snippet to the end of the file:

[Element Line Out]
switch = mute
volume = merge

3. We need to completely cut off Line Out when we use headphones. Edit:

/usr/share/pulseaudio/alsa-mixer/paths/analog-output-headphones.conf

Add this snippet to the end of the file:

[Element Line Out]
switch = off
volume = off

4. Like Pulseaudio, Alsa itself cuts off speakers when headphones are plugged in. Open alsamixer (in case of Realtek HDA alsamixer -c0) and change Auto-Mute mode to disabled.

5. Restart Pulseaudio

$ pulseaudio -k
$ pulseaudio --start

Now you have two separate ports on the same sink in pulseaudio. They mute each other, so you can switch to headphones and this will mute Line Out, and vice versa. To switch between ports you can use Gnome or Plasma sound mixer, or install appropriate desktop extension. 
*** kernel parameters
To make the change persistent after reboot, you could manually edit /boot/grub/grub.cfg with the exact line from above, but the best practice is to:
Edit /etc/default/grub and append your kernel options between the quotes in the GRUB_CMDLINE_LINUX_DEFAULT line:
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
and then make the crub config again:
# grub-mkconfig -o /boo/grub/grub.cfg
**** ryzen 5 crash
add "processor.max_cstate=1" to the kernel boot options
**** apparmor
"apparmor=1 lsm=lockdown,yama,apparmor,bpf""
